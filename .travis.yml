env:
    - SMVERSION=1.6
before_install:
    - sudo apt-get -qq update
    - sudo apt-get install gcc-multilib lynx > /dev/null
install:
    - SMPATTERN="http:.*sourcemod-.*-git.*-linux.*"
    - SMURL="http://www.sourcemod.net/smdrop/$SMVERSION/"
    - SMPACKAGE=`lynx -dump "$SMURL" | egrep -o "$SMPATTERN" | tail -1`
    - wget $SMPACKAGE
    - tar -xzf $(basename "$SMPACKAGE")
    - STEAMTOOLSURL="http://builds.limetech.org/files/"
    - STEAMTOOLSPATTERN="http:.*steamtools-.*-git.*-.*-linux.zip"
    - STEAMTOOLSPACKAGE=`lynx -dump "$STEAMTOOLSURL" | egrep -o "$STEAMTOOLSPATTERN" | tail -1`
    - wget $STEAMTOOLSPACKAGE
    - unzip -ou $(basename "$STEAMTOOLSPACKAGE")
before_script:
    - cd addons/sourcemod/scripting/
    - wget "https://www.doctormckay.com/download/scripting/include/morecolors.inc"
    - mv morecolors.inc include/morecolors.inc
    - chmod +x spcomp
script:
    - ./compile.sh class_warfare.sp

#Releases
before_deploy:
    - mv compiled/class_warfare.smx .
deploy:
    provider: releases
    api_key:
        secure: a7ix8TmzAUmekBi3Zb/2eXNdoBWOW1pM3214qP+AiVJ9pYNQrC+wDpqt2RqDIctGJANrCedhxWzT8Ma+39B5QJ9z31Cfe/rxwIMH+Yd/jcUVOPfsFagAZdkABdd5ftdAkbdw/kJMoqtdX7vQbAhntSW0AChSfi0w/cewPi52kJs=
    file:
        - class_warfare.sp
        - class_warfare.smx
    on:
        repo: 50DKP/Class-Warfare
        branch: master
        tags: true
